@{
    Layout = "_Layout";
}
<main>
    <div class="container">

        <!-- Filtro por fecha -->
        <section class="filter-section">
            <label for="fechaFiltro" class="filter-label">Filtrar por fecha:</label>
            <input type="date" id="fechaFiltro" />
        </section>

        <div class="card-surv" id="encuestasContainer">

        </div>

        <a href="/Users/AgregarEncuesta" class="add-button" title="Agregar nueva encuesta">+</a>


    </div>

</main>

<script>
    const token = localStorage.getItem("token");
    const userId = localStorage.getItem("idUsuario");

    async function cargarMisEncuestas() {

        try {
            const response = await fetch(`https://apiencuestase8.websitos256.com/api/encuestas/usuario/${userId}`, {
                method: "GET",
                headers: {
                    "Authorization": "Bearer " + token
                }
            });

            if (!response.ok) {
                throw new Error("No se pudieron cargar tus encuestas");
            }

            const encuestas = await response.json();

            const container = document.getElementById("encuestasContainer");
            container.innerHTML = "";

            const listaEncuestas = Array.isArray(encuestas) ? encuestas : [encuestas];

            listaEncuestas.forEach(encuesta => {
                const card = document.createElement("div");
                card.className = "card-surv";

                card.innerHTML = `
                      <a  href="/Users/DetalleEncuesta?id=${encuesta.id}" class="survey-card">
                        <div class="survey-info">
                       <strong>${encuesta.titulo}</strong><br />
                       <small>Creada el ${new Date(encuesta.fechaCreacion).toLocaleDateString()}</small>
                        </div>
                      </a>
                      <div class="survey-actions">
                         <a href="/Users/EditarEncuesta?id=${encuesta.id}" class="edit-btn" title="Editar encuesta">✏️</a>
                         <a href="/Users/EliminarEncuesta?id=${encuesta.id}"  class="delete-btn" title="Eliminar encuesta">🗑️</a>
                      </div>
                `;

                container.appendChild(card);
            });

        } catch (error) {
            console.error(error);
            alert("Error al cargar tus encuestas.");
        }
    }

    window.addEventListener("DOMContentLoaded", cargarMisEncuestas);

    // Función para filtrar encuestas por fecha
    document.getElementById('fechaFiltro').addEventListener('input', function() {
      const filtro = this.value; // yyyy-mm-dd
      const allSurveys = document.querySelectorAll('#allSurveys .survey-card');
      const featuredSurveys = document.querySelectorAll('#featuredSurveys .survey-card');

      function filtrarEncuestas(lista) {
        lista.forEach(encuesta => {
          const fechaEncuesta = encuesta.getAttribute('data-fecha');
          if (!filtro || fechaEncuesta >= filtro) {
            encuesta.style.display = 'block';
          } else {
            encuesta.style.display = 'none';
          }
        });
      }

      filtrarEncuestas(allSurveys);
      filtrarEncuestas(featuredSurveys);
    });
</script>