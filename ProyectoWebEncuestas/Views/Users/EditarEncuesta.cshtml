@{
    Layout = "_Layout";
}
<main class="container">
    <form id="editSurveyForm">
        <div class="form-group">
            <label for="surveyName">Nombre de la encuesta</label>
            <input type="text" id="surveyName" name="surveyName" required />
        </div>

        <div id="questionsContainer">
            <div class="form-group question-item">
                <div class="question-input-wrapper">
                    <div class="text-input-group">
                        <label for="question1">Pregunta:</label>
                        <input type="text" id="question1" name="questions[]" required />
                    </div>
                    <div class="number-input-group">
                        <label for="questionNumber1">Número:</label>
                        <input type="text" id="questionNumber1" name="questionNumbers[]" />
                    </div>
                </div>
            </div>
        </div>
        <div class="button-group">
            <button type="button" class="btn-add" onclick="addQuestion()">Agregar otra pregunta</button>
        </div>

        <div class="button-group">
            <button type="submit" class="submit-button">Guardar cambios</button>
            <button type="button" class="cancel-button" onclick="cancelar()">Cancelar</button>
        </div>
    </form>
</main>

<script>
    document.addEventListener("DOMContentLoaded", async function () {
        const params = new URLSearchParams(window.location.search);
        const id = params.get("id");
        const token = localStorage.getItem("token");

        if (!id || !token) {
            alert("Token o ID de encuesta no encontrado.");
            window.location.href = "/Login";
            return;
        }
            console.log("Usando token:", token);
    console.log("URL final:", `https://apiencuestase8.websitos256.com/api/encuestas/con-preguntas/${id}`);
        try {
            const res = await fetch(`https://apiencuestase8.websitos256.com/api/encuestas/con-preguntas/${id}`, {
                headers: {
                    "Authorization": `Bearer ${token}`
                }
            });

            if (!res.ok) {
                const errorText = await res.text();
                throw new Error(`(${res.status}) ${errorText}`);
            }

            const encuesta = await res.json();
            document.getElementById("surveyName").value = encuesta.titulo;

            const container = document.getElementById("questionsContainer");
            container.innerHTML = "";

            encuesta.preguntas.forEach((p, i) => {
                container.innerHTML += `
                    <div class="form-group question-item">
                        <input type="hidden" name="questionIds[]" value="${p.id}" />
                        <div class="question-input-wrapper">
                            <div class="text-input-group">
                                <label>Pregunta:</label>
                                <input type="text" name="questions[]" value="${p.descripcion}" required />
                            </div>
                            <div class="number-input-group">
                                <label>Número:</label>
                                <input type="number" name="questionNumbers[]" value="${p.numeroPregunta}" required min="1" max="10" />
                            </div>
                        </div>
                    </div>
                `;
            });

        } catch (err) {
            console.error("Error al cargar encuesta:", err.message);
            alert("Error al cargar la encuesta: " + err.message);
            window.location.href = "/Users/Index";
        }
    });
</script>